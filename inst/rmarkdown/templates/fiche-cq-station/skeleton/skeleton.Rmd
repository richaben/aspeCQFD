---
title: "Fiche CQ données ASPE - Station `r params$code_station`"
author: "`r params$auteur`"
subtitle: "`r unique(df_data[df_data$code_sta_pp %in% params$code_station,]$sta_libelle_sandre)`"
date: "`r format(Sys.time(), '%d %B %Y')`"
output: 
  html_document :
    highlight: pygments #default, tango, pygments, kate, monochrome, espresso, zenburn, haddock, and textmate 
    theme: default #“default”, “cerulean”, “journal”, “flatly”, “readable”, “spacelab”, “united”, “cosmo”, “lumen”, “paper”, “sandstone”, “simplex”, “yeti”
    toc: false
    css: 'ofb_theme_html.css'
params:
  df_data: NULL
  code_station: "03231000_013"
  auteur: "DR Normandie"
  annee_debut: 2010
  annee_fin: 2022  
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      warning = FALSE,
                      message = FALSE)
```

```{r, echo = FALSE}
htmltools::img(src = knitr::image_uri('logo_OFB_v2.png'),
               alt = 'logo',
               style = 'position:absolute; top:0; right:0; padding:10px; width:180px;')
```


> ⚠ **Important / Préambule** :<br><br>
> 
> Les données couvrent la période de **`r params$annee_debut` à `r params$annee_fin`** (paramètres de filtres pour la génération de cette fiche). <br>
> Les graphiques présentés ci-dessous ont pour vocation principale à la mise en qualité des données (et pas vraiment à l'analyse des variations sur les variables bancarisées). Les graphiques, confrontés entre eux, permettent de détecter d'éventuelles erreurs ou problèmes de cohérence dans les données. <br> 
>

## Résumé des opérations

```{r}
ope_list <-
  get_liste_ope_station(df = aspe_table_fiches, 
                      code_sta_pp = params$code_station) %>%
  dplyr::select(-dept) %>% 
  dplyr::filter(format(ope_date, "%Y") >= params$annee_debut & 
                  format(ope_date, "%Y") <= params$annee_fin)

df_station <-
  aspe_table_fiches %>% 
  dplyr::filter(code_sta_pp == params$code_station) %>% 
  dplyr::filter(format(ope_date, "%Y") >= params$annee_debut & 
                  format(ope_date, "%Y") <= params$annee_fin)
```

Pour cette station, il y a **`r nrow(ope_list)` opération(s)** bancarisée(s) dans ASPE (entre l'année `r params$annee_debut` et l'année `r params$annee_fin`, paramètres de filtres). 

```{r}
ope_list %>% 
  knitr::kable()
```

### Jours de pêche sur la station

```{r, fig.width=8, fig.height=4}
ope_list %>% 
 plot_jour_peche()
```

## Objectifs et protocole de pêche

```{r, fig.width=11, fig.height=4}
df_station %>% 
  plot_objectif_reseau()
```

```{r, fig.width=11, fig.height=6}
df_station %>% 
  dplyr::select(code_sta_pp, sta_libelle_sandre, ope_id, annee) %>% 
  mef_ajouter_infos_context() %>% 
  unique() %>% 
  plot_infos_context()
```


## Mise en oeuvre de la pêche
### Description pêche

```{r, fig.width=11, fig.height=6}
df_tab_protocole_pts <-
  df_station %>% 
  mef_tab_protocole_pts()

df_tab_protocole_pts %>% 
  plot_proto_prospec_passage()
```

### Descriptions pêche et environnement

```{r, fig.width=11, fig.height=10}
df_station %>% 
  plot_descript_peche_env()
```


## Données environnementales
### faciès

```{r, fig.width=12, fig.height=10}
df_station %>% 
  mef_ajouter_facies() %>% 
  plot_facies_data()
```

### habitat

```{r, fig.width=12, fig.height=8.5}
df_station %>% 
  plot_habitat_data()
```


## Saisies piscicoles
### Le cortège d'espèces

```{r, fig.height=7.5, fig.width=12}
df_station %>% 
  plot_peuplement_data()
```

### L'indice poisson rivière (IPR)

```{r, fig.width=10, fig.height=7}

```


```{r, fig.width=10, fig.height=8}

```


```{r, fig.width=12, fig.height=7.5}

```

### Commentaires

```{r}
df_station %>% 
  dplyr::select(ope_id, ope_date, ope_commentaire) %>% 
  unique() %>% 
  dplyr::mutate(ope_date = as.Date(ope_date, format = "%Y-%m-%d")) %>%
  knitr::kable()
```

